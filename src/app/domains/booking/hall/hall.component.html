<ng-container
  *ngIf="chosenShowing$ | async as chosenMovieShowing"
  class="hall-page"
>
  <ng-container *ngIf="orderItems$ | async as orderItem">
    <div class="choosen-showing-info">
      <h1 class="movie-title">{{ chosenMovieShowing.movie.title }}</h1>
      <div class="movie-time-info">
        <span class="movie-detail">data: {{ chosenMovieShowing.date }}</span>
        <span class="movie-detail">
          godz. {{ chosenMovieShowing.timeFrom }}
        </span>
        <span>sala nr: {{ chosenMovieShowing.hall.number }}</span>
      </div>
    </div>
    <br />

    <ng-container *ngIf="occupiedSeatIds$ | async as occupiedSeatIds">
      <div class="seats-wrapper">
        <div class="screen">
          <!-- <h2>Ekran</h2> -->
        </div>
        <ng-container *ngIf="rows$ | async as rows">
          <li *ngFor="let row of rows | keyvalue" class="row">
            <span>{{ row.key }}</span>
            <ng-container *ngFor="let column of row.value | keyvalue">
              <button
                (click)="clickChosenSeat(column.value, chosenMovieShowing.id)"
                [ngClass]="checkIfSeatIsChosen(column.value) ? 'selected' : ''"
                [ngDisabled]="clickCount > maxClickCount"
                class="seat"
                [disabled]="occupiedSeatIds.includes(column.value.id)"
              ></button>
            </ng-container>
          </li>
        </ng-container>
      </div>
    </ng-container>
    <p *ngIf="clickCount > maxClickCount">
      Możesz wybrać maksymalnie 10 biletów.
    </p>

    <p class="select-seat-info">Wybierz miejsce, aby dodać bilet</p>
    <div class="choosen-seat-info">
      <ul class="chosen-tickets-list">
        <li *ngFor="let chosenSeat of orderItem" class="chosen-seat">
          <ng-container *ngIf="chosenSeat.showingId === chosenMovieShowing.id">
            <span>Rząd: {{ chosenSeat.seat.row }}</span>
            <span>Miejsce: {{ chosenSeat.seat.column }}</span>

            <select
              value="selectedTicket"
              [(ngModel)]="chosenSeat.ticket"
              (ngModelChange)="selectTicket(chosenSeat)"
              class="ticket-type-wrapper"
            >
              <option [ngValue]="null" selected disabled>Wybierz bilet</option>
              <option
                *ngFor="let ticket of tickets$ | async; let i = index"
                [ngValue]="ticket"
                class="ticket-type"
              >
                {{ ticket.name }}
                <fa-icon [icon]="arrowIcon" class="arrow-icon"></fa-icon>
              </option>
            </select>
            <span class="price">Cena: {{ chosenSeat.ticket?.price }}zł </span>
            <button
              (click)="deleteChosenTicket(chosenSeat)"
              type="button"
              class="delete-ticket-button"
            >
              <fa-icon [icon]="trashIcon" class="trash"></fa-icon>
            </button>
          </ng-container>
        </li>
      </ul>
    </div>
    <div class="redirection-to-form">
      <a
        *ngIf="orderItem && orderItem.length > 0"
        [routerLink]="[
          '/booking/reservation',
          chosenMovieShowing.id,
          chosenMovieShowing.movie.title
        ]"
        (click)="saveChosenSeatsAndTicketsInLocalStorage(orderItem)"
      >
        Przejdź do zamówienia
      </a>
    </div>
  </ng-container>
</ng-container>
